<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foto Viewer</title>
    <style>
        #map {
            height: 300px;
            width: 100%;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <h1>Foto Viewer</h1>

    <!-- Form untuk mengunggah foto -->
    <form id="uploadForm">
        <label for="photo">Pilih Foto:</label>
        <input type="file" id="photo" accept="image/*">
        <br>
        <label for="address">Alamat Lengkap:</label>
        <input type="text" id="address" required>
        <br>
        <label for="latitude">Latitude:</label>
        <input type="text" id="latitude" required>
        <br>
        <label for="longitude">Longitude:</label>
        <input type="text" id="longitude" required>
        <br>
        <button type="button" onclick="uploadPhoto()">Unggah Foto</button>
    </form>

    <!-- Tampilan foto dan informasi -->
    <div id="photoInfo" style="display:none;">
        <img id="uploadedPhoto" style="max-width: 100%;">
        <p>Alamat: <span id="displayAddress"></span></p>
        <p>Latitude: <span id="displayLatitude"></span></p>
        <p>Longitude: <span id="displayLongitude"></span></p>
        <div id="map"></div>
        <a id="downloadLink" download="edited_photo.jpg" style="display:none;">Download Foto</a>
    </div>

    <script>
        function uploadPhoto() {
            var photoInput = document.getElementById('photo');
            var addressInput = document.getElementById('address').value;
            var latitudeInput = document.getElementById('latitude').value;
            var longitudeInput = document.getElementById('longitude').value;

            if (photoInput.files.length > 0) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var photo = document.getElementById('uploadedPhoto');
                    photo.src = e.target.result;

                    // Tampilkan informasi
                    document.getElementById('displayAddress').innerText = addressInput;
                    document.getElementById('displayLatitude').innerText = latitudeInput;
                    document.getElementById('displayLongitude').innerText = longitudeInput;

                    // Tampilkan peta
                    showMap(latitudeInput, longitudeInput);

                    // Tampilkan tombol download
                    document.getElementById('downloadLink').style.display = 'block';
                };

                reader.readAsDataURL(photoInput.files[0]);

                // Tampilkan informasi
                document.getElementById('photoInfo').style.display = 'block';
            }
        }

        function showMap(latitude, longitude) {
            var map = L.map('map').setView([latitude, longitude], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            L.marker([latitude, longitude]).addTo(map)
                .bindPopup('Lokasi Foto').openPopup();
        }

        // Fungsi untuk menghasilkan file foto yang dapat diunduh
        function downloadPhoto() {
            var canvas = document.createElement('canvas');
            var photo = document.getElementById('uploadedPhoto');
            canvas.width = photo.width;
            canvas.height = photo.height;
            var ctx = canvas.getContext('2d');
            ctx.drawImage(photo, 0, 0, canvas.width, canvas.height);

            var downloadLink = document.getElementById('downloadLink');
            canvas.toBlob(function (blob) {
                var url = URL.createObjectURL(blob);
                downloadLink.href = url;
            }, 'image/jpeg');
        }
    </script>

    <!-- Pustaka Leaflet untuk peta -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

</body>
</html>
